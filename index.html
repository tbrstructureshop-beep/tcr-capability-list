<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Capability List Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- Export to Excel-->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>

    /* ================= LOGIN PAGE ================= */
     #loginPage {
     position: fixed;
     inset: 0;
     background: linear-gradient(135deg, #0a8a94, #005a61);
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 10000;
    }

    .login-card {
      background: #ffffff;
      width: 100%;
      max-width: 360px;
      padding: 28px;
      border-radius: 14px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      text-align: center;
    }

    .login-card,
    .login-card * {
      box-sizing: border-box;
    }

    .login-card h2 {
      margin: 0;
      font-size: 22px;
      color: #0f172a;
    }

    .login-sub {
      margin: 6px 0 20px;
      font-size: 13px;
      color: #64748b;
    }

    .login-field {
     text-align: left;
     margin-bottom: 14px;
    }

    .login-field label {
      font-size: 12px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 4px;
      display: block;
    }

    .login-field input {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      outline: none;
    }

    .login-field input:focus {
      border-color: #00717a;
    }

    .login-btn {
      width: 100%;
      margin-top: 12px;
      padding: 10px;
      font-size: 15px;
      border-radius: 10px;
      border: none;
      background: #00717a;
      color: #ffffff;
      cursor: pointer;
    }

    .login-btn:hover {
      background: #005a61;
    }

    #loginError {
      margin-top: 12px;
      font-size: 13px;
      color: #dc2626;
      display: none;
    }

    :root {
      --bg: #f4f6f8;
      --card: #ffffff;
      --border: #dcdfe3;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #2563eb;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      margin-bottom: 12px;
      font-size: 22px;
      font-weight: 600;
      text-align: center;
    }

    .table-card {
      margin-bottom: 14px;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
      overflow: visible;   /* âœ… REQUIRED */
    }

    .table-wrapper {
      overflow: auto;
      max-height: 70vh;
      display: block;
    }

    table {
      border-collapse: separate;
      border-spacing: 0;
      table-layout: fixed;
      width: 100%;
      min-width: 1200px;
      max-width: 1800px;
      margin: 0 auto;
    }

    thead tr.header-row th {
      background: linear-gradient(
      180deg,
      #0a8a94 0%,
      #00717a 50%,
      #005a61 100%);
      color: #ffffff;
      border-bottom: 2px solid #155f7a;
      padding: 14px 12px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      white-space: normal;
      word-break: break-word;
      min-width: 120px;
      max-width: 220px;
      position: sticky;
      top: 0;
      z-index: 5;   /* ðŸ‘ˆ higher than filter row */
    }

    thead tr.filter-row th {
      background: #ffffff;
      border-bottom: 1px solid var(--border);
      padding: 6px 8px;
      text-align: center;
      position: sticky;
      top: var(--header-height);  /* ðŸ‘ˆ NO MAGIC NUMBER */
      z-index: 3;
    }

    thead input {
      width: 90%;
      max-width: 160px;
      padding: 6px 8px;
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      outline: none;
      text-align: center; /* center the placeholder text */
    }

    thead input:focus {
      border-color: var(--accent);
    }

    tbody td {
      border-bottom: 1px solid var(--border);
      padding: 12px 12px;
      font-size: 13px;
      text-align: center;
      white-space: normal;
      word-break: break-word;
      line-height: 1.45;
      min-width: 120px;
      max-width: 220px;
    }

    tbody tr:hover {
      background: #e0e7ff;
    }

    /* Zebra striping */
    tbody tr:nth-child(odd) { background: #ffffff; }
    tbody tr:nth-child(even) { background: #f8fafc; }

    .footer-note {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    .spinner {
      width: 42px;
      height: 42px;
      border: 4px solid #e5e7eb;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }

    .paginationBar button {
      padding: 4px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
    }

    .paginationBar button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .rowsPerPage, #gotoPage {
      padding: 4px;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .action-btn {
     height: 36px;                 /* ðŸ‘ˆ SAME HEIGHT */
     padding: 0 16px;
     border-radius: 8px;
     border: 1px solid var(--border);
     font-size: 14px;
     font-weight: 500;
     line-height: 36px;            /* ðŸ‘ˆ vertical center */
     cursor: pointer;
     display: inline-flex;
     align-items: center;
     background: #fff;
    }

    .export-btn {
     background: var(--accent);
     color: #fff;
    }

    #logoutBtn {
     background: #fff;
     color: #374151;
    }

    #logoutBtn:hover {
      background: #f3f4f6;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<div id="loginPage">
  <div class="login-card">
    <h2>Capability Dashboard</h2>
    <p class="login-sub">Secure Access Created By TC</p>

    <div class="login-field">
      <label>Username</label>
      <input id="loginUser" type="text" placeholder="Enter username">
    </div>

    <div class="login-field">
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="Enter password">
    </div>

    <button class="login-btn" onclick="handleLogin()">Login</button>

    <div id="loginError">Invalid username or password</div>
  </div>
</div>

<div id="dashboard" style="display:none;">

  <div style="display:flex;justify-content:flex-end;margin-bottom:10px;">
    <button id="logoutBtn" class="action-btn">
    Logout
    </button>
  </div>

  <h1>Component Capability Web</h1>

  <div style="display:flex;justify-content:center;gap:10px;margin-bottom:12px;flex-wrap:wrap;">
    <input id="globalSearch" type="text" placeholder="Search across all columnsâ€¦" style="min-width:280px;max-width:420px;width:40%;padding:8px 12px; border-radius:10px;border:1px solid var(--border);font-size:14px;" />
    <button id="searchBtn" style="padding:8px 16px;border-radius:10px;border:1px solid var(--border);background:var(--accent);color:#fff;cursor:pointer;">
      Search
    </button>
  </div>

  <div style="text-align:center;margin-bottom:10px;">
    <button onclick="toggleFilters()" style="padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer;">
    Show / Hide Filters
    </button>
  </div>

  <div id="loader" style="display:none;position:fixed;inset:0;background:rgba(255,255,255,0.75);z-index:9999;align-items:center;justify-content:center;">
    <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
      <div class="spinner"></div>
      <div style="font-size:13px;color:var(--muted);">Loading dataâ€¦</div>
    </div>
  </div>

  <div id="paginationBar" style="
    display:flex;
    justify-content:flex-start;
    align-items:center;
    gap:10px;
    margin-top:12px;
    margin-bottom:16px;
    flex-wrap:wrap;
    font-size:13px;
    ">

    <!-- Rows per page -->

    <label>
        Show
        <select id="rowsPerPage">
          <option value="10">10</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="all">All</option>
        </select>
        rows
    </label>

    <!-- Prev -->
    <button id="prevPage">â—€ Prev</button>

    <!-- Page info -->
    <span id="pageInfo">Page 1 of 1</span>

    <!-- Go to page -->
    <label>
       Go to
       <input id="gotoPage" type="number" min="1" style="width:60px;">
    </label>

    <!-- Next -->
    <button id="nextPage">Next â–¶</button>
  </div>

  <div class="table-card">
    <div class="table-wrapper">
      <table id="dataTable">
        <thead>
          <tr class="header-row" id="headerRow"></tr>
          <tr class="filter-row" id="filterRow"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
  
  <div id="dataStatus" style="
    margin-top: 8px;
    font-size: 13px;
    color: var(--muted);
    text-align: left;
    ">
  </div>

  <div style="display:flex;justify-content:flex-end;gap:10px;margin-bottom:10px;">
    <button id="actionBtn" class="action-btn">
    Action
    </button>

    <button id="exportBtn" class="action-btn export-btn" style="display:none;">
    Save to Excel
   </button>
  </div>

  <div class="footer-note">
    Created on 10 January 2026
  </div>
</div>

<!-- LOGOUT CONFIRM MODAL -->
<div id="logoutConfirm" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  z-index:20000;
  align-items:center;
  justify-content:center;
">
  <div style="
    background:#ffffff;
    padding:24px;
    border-radius:14px;
    width:100%;
    max-width:320px;
    box-shadow:0 20px 40px rgba(0,0,0,0.25);
    text-align:center;
  ">
    <h3 style="margin:0 0 10px;font-size:18px;color:#111827;">
      Do you want to log out?
    </h3>

    <p style="margin:0 0 18px;font-size:13px;color:#6b7280;">
      You will be returned to the login page.
    </p>

    <div style="display:flex;gap:10px;justify-content:center;">
      <button id="logoutNo" style="
        padding:8px 16px;
        border-radius:8px;
        border:1px solid #dc2626;
        background:#dc2626;
        color:#fff;
        cursor:pointer;
        font-size:14px;
      ">
        No
      </button>

      <button id="logoutYes" style="
        padding:8px 16px;
        border-radius:8px;
        border:1px solid var(--accent);
        background:var(--accent);
        color:#fff;
        cursor:pointer;
        font-size:14px;
      ">
        Yes
      </button>
    </div>
  </div>
</div>

<script>


const FIXED_USER = "caplistmadebytc";
const FIXED_PASS = "Aeroas1@63";

function handleLogin() {
  const user = document.getElementById("loginUser").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  const error = document.getElementById("loginError");

  if (user === FIXED_USER && pass === FIXED_PASS) {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
  } else {
    error.style.display = "block";
  }
}

// PAGNATION
let currentPage = 1;
let rowsPerPage = 10;

function showLoader() {
  document.getElementById("loader").style.display = "flex";
}

function hideLoader() {
  document.getElementById("loader").style.display = "none";
}

let filtersVisible = false;
function toggleFilters() {
  const row = document.getElementById("filterRow");
  filtersVisible = !filtersVisible;
  row.style.display = filtersVisible ? "table-row" : "none";
}

// CSV config
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQv9q0DjJSNZSP3uiP1OHEZSiG6uZ46Dye12w7FtQ5UxjazWR0DeISWGWGCHOCEjbH9tpvDb8yxZp7U/pub?gid=1957846393&single=true&output=csv";
const DISPLAY_COLS = [0,1,2,3,4,5,6,7,8,14,15];

let rawData = [];
let viewData = [];

let globalKeyword = "";
let columnFilters = {};

showLoader();
Papa.parse(CSV_URL, {
  download: true,
  skipEmptyLines: true,
  complete: function(results) {
    const rows = results.data;
    const headerRow1 = rows[0];
    const headerRow2 = rows[1];

    const headers = DISPLAY_COLS.map(i =>
      `${headerRow1[i] || ""} ${headerRow2[i] || ""}`.trim()
    );

    buildHeader(headers);
    rawData = rows.slice(3).map(r => DISPLAY_COLS.map(i => r[i] ?? ""));
    viewData = rawData;
    renderTable(viewData);
    updateDataStatus();
    hideLoader();
  }
});

let actionMode = false;

function buildHeader(headers) {
  const headerRow = document.getElementById("headerRow");
  const filterRow = document.getElementById("filterRow");

  headerRow.innerHTML = "";
  filterRow.innerHTML = "";

  // ðŸ”¹ ACTION COLUMN (checkbox)
  const actionTh = document.createElement("th");
  actionTh.style.display = "none";
  actionTh.id = "actionHeader";
  actionTh.innerHTML = `<input type="checkbox" id="selectAll">`;
  headerRow.appendChild(actionTh);

  const actionFilterTh = document.createElement("th");
  actionFilterTh.style.display = "none";
  filterRow.appendChild(actionFilterTh);

  // ðŸ”¹ DATA COLUMNS
  headers.forEach((h, index) => {
    // Header label
    const th = document.createElement("th");
    th.textContent = h;
    headerRow.appendChild(th);

    // Filter input
    const filterTh = document.createElement("th");
    const input = document.createElement("input");

    input.placeholder = "FILTER";
    input.dataset.index = index;

    input.addEventListener("input", e => {
      const idx = Number(e.target.dataset.index);
      columnFilters[idx] = e.target.value.toLowerCase();
      applyAllFilters();   // âœ… unified pipeline
    });

    filterTh.appendChild(input);
    filterRow.appendChild(filterTh);
  });

  filterRow.style.display = filtersVisible ? "table-row" : "none";
}


function updatePaginationInfo(totalRows) {
  const pageInfo = document.getElementById("pageInfo");
  const prevBtn = document.getElementById("prevPage");
  const nextBtn = document.getElementById("nextPage");
  const gotoInput = document.getElementById("gotoPage");

  if (rowsPerPage === "all") {
    pageInfo.textContent = `Showing all ${totalRows} rows`;
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    gotoInput.disabled = true;
    return;
  }

  const totalPages = Math.ceil(totalRows / rowsPerPage) || 1;

  pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
  prevBtn.disabled = currentPage <= 1;
  nextBtn.disabled = currentPage >= totalPages;
  gotoInput.max = totalPages;
  gotoInput.disabled = false;
}


function renderTable(data) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  let start = 0;
  let end = data.length;

  if (rowsPerPage !== "all") {
    start = (currentPage - 1) * rowsPerPage;
    end = start + rowsPerPage;
  }

  data.slice(start, end).forEach((row, rowIndex) => {
    const tr = document.createElement("tr");

    // ACTION CHECKBOX
    const tdCheck = document.createElement("td");
    tdCheck.style.display = actionMode ? "table-cell" : "none";
    tdCheck.innerHTML = `
      <input type="checkbox" class="rowCheck" data-index="${start + rowIndex}">
    `;
    tr.appendChild(tdCheck);

    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  updatePaginationInfo(data.length);
}


function applyFilters() {
  showLoader();
  const inputs = document.querySelectorAll("thead input");

  currentPage = 1;

  let filtered = [...rawData];

  inputs.forEach(input => {
    const value = input.value.trim().toLowerCase();
    const index = Number(input.dataset.index);
    if (value) {
      filtered = filtered.filter(row =>
        String(row[index]).toLowerCase().includes(value)
      );
    }
  });

  viewData = filtered;
  renderTable(viewData);
  updateDataStatus();
  hideLoader();
}

// GLOBAL SEARCH FUNCTION
function applyGlobalSearch() {
  globalKeyword = document
    .getElementById("globalSearch")
    .value
    .trim()
    .toLowerCase();

  currentPage = 1;
  applyAllFilters();
}

function applyAllFilters() {
  showLoader();
  currentPage = 1;

  let filtered = [...rawData];

  // ðŸ”¹ Column filters
  Object.keys(columnFilters).forEach(index => {
    const value = columnFilters[index];
    if (value) {
      filtered = filtered.filter(row =>
        String(row[index]).toLowerCase().includes(value)
      );
    }
  });

  // ðŸ”¹ Global search (applies AFTER column filters)
  if (globalKeyword) {
    filtered = filtered.filter(row =>
      row.some(cell =>
        String(cell).toLowerCase().includes(globalKeyword)
      )
    );
  }

  viewData = filtered;
  renderTable(viewData);
  updateDataStatus();
  hideLoader();
}


function updateDataStatus() {
  const el = document.getElementById("dataStatus");
  if (!el) return;

  const total = rawData.length;
  const filtered = viewData.length;

  let showing;

  if (rowsPerPage === "all") {
    showing = filtered;
  } else {
    const start = (currentPage - 1) * rowsPerPage;
    showing = Math.min(rowsPerPage, filtered - start);
    if (showing < 0) showing = 0;
  }

  let text = "";

  // ðŸ”¹ No filter applied
  if (filtered === total) {
    if (rowsPerPage === "all") {
      text = `Showing all ${total} data`;
    } else {
      text = `Showing ${showing} of ${total} data`;
    }
  }
  // ðŸ”¹ Filter / search applied
  else {
    if (rowsPerPage === "all") {
      text = `Showing all ${filtered} related data`;
    } else {
      text = `Showing ${showing} of ${filtered} related data`;
    }
  }

  el.textContent = text;
}

// Search events
document.getElementById("globalSearch").addEventListener("keydown", e => {
  if (e.key === "Enter") applyGlobalSearch();
});
document.getElementById("searchBtn").addEventListener("click", applyGlobalSearch);


// Wire Pagnation Event

document.getElementById("rowsPerPage").addEventListener("change", e => {
  rowsPerPage = e.target.value === "all" ? "all" : Number(e.target.value);
  currentPage = 1;
  showLoader();
  setTimeout(() => {
    renderTable(viewData);
    updateDataStatus();
    hideLoader();
  }, 150);
});

document.getElementById("prevPage").addEventListener("click", () => {
  if (currentPage > 1) {
    currentPage--;
    showLoader();
    setTimeout(() => {
      renderTable(viewData);
      updateDataStatus();
      hideLoader();
    }, 150);
  }
});

document.getElementById("nextPage").addEventListener("click", () => {
  currentPage++;
  showLoader();
  setTimeout(() => {
    renderTable(viewData);
    updateDataStatus();
    hideLoader();
  }, 150);
});

document.getElementById("gotoPage").addEventListener("change", e => {
  const page = Number(e.target.value);
  if (!isNaN(page) && page >= 1) {
    currentPage = page;
    showLoader();
    setTimeout(() => {
      renderTable(viewData);
      updateDataStatus();
      hideLoader();
    }, 150);
  }
});

document.getElementById("actionBtn").addEventListener("click", () => {
  actionMode = !actionMode;

  document.getElementById("exportBtn").style.display = actionMode ? "inline-block" : "none";
  document.getElementById("actionHeader").style.display = actionMode ? "table-cell" : "none";

  document.querySelectorAll("#filterRow th")[0].style.display = actionMode ? "table-cell" : "none";

  document.querySelectorAll(".rowCheck").forEach(cb => {
    cb.parentElement.style.display = actionMode ? "table-cell" : "none";
  });

  renderTable(viewData);
  updateDataStatus();
});

document.addEventListener("change", e => {
  if (e.target.id === "selectAll") {
    document.querySelectorAll(".rowCheck").forEach(cb => {
      cb.checked = e.target.checked;
    });
  }
});

document.getElementById("exportBtn").addEventListener("click", () => {
  const selectedIndexes = [...document.querySelectorAll(".rowCheck:checked")]
    .map(cb => Number(cb.dataset.index));

  if (!selectedIndexes.length) {
    alert("No rows selected");
    return;
  }

  const selectedData = selectedIndexes.map(i => viewData[i]);

  // HEADERS
  const headers = [...document.querySelectorAll("#headerRow th")]
    .slice(1) // skip action column
    .map(th => th.textContent);

  const sheetData = [
    headers,
    ...selectedData
  ];

  const ws = XLSX.utils.aoa_to_sheet(sheetData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Selected Data");

  XLSX.writeFile(wb, "Selected_Capability_Data.xlsx");
});

/* ================= LOGOUT LOGIC ================= */

const logoutModal = document.getElementById("logoutConfirm");

document.getElementById("logoutBtn").addEventListener("click", () => {
  logoutModal.style.display = "flex";
});

document.getElementById("logoutNo").addEventListener("click", () => {
  logoutModal.style.display = "none";
});

document.getElementById("logoutYes").addEventListener("click", () => {
  location.reload(); // hard reset â†’ back to login
});


</script>

</body>
</html>



